# Анализ методов в микросервисах TicketApp

## ADMIN-SERVICE (http://localhost:5003)
Backend сервис - управление концертами, билетами, артистами, бронированиями

### JSON API Endpoints (НУЖНО ОСТАВИТЬ)

#### Concerts Management
| Метод | Статус | Причина |
|-------|--------|---------|
| **POST `/api/admin/create_concert`** | ✅ НУЖЕН | Создание концерта администратором через API |
| **GET `/api/concerts`** | ✅ НУЖЕН | Получение списка всех концертов (для фронтенда и внешних клиентов) |
| **GET `/api/concerts/<id>`** | ✅ НУЖЕН | Получение деталей концерта (для фронтенда и внешних клиентов) |
| **PUT `/api/admin/concerts/<id>`** | ✅ НУЖЕН | Обновление концерта администратором |
| **DELETE `/api/admin/concerts/<id>`** | ✅ НУЖЕН | Удаление концерта администратором |

#### Ticket Types Management
| Метод | Статус | Причина |
|-------|--------|---------|
| **POST `/api/admin/concerts/<id>/ticket_types`** | ✅ НУЖЕН | Добавление типа билета к концерту |
| **DELETE `/api/admin/delete-ticket/<id>`** | ✅ НУЖЕН | Удаление типа билета (через /admin/delete-ticket, но используется) |

#### Artists Management
| Метод | Статус | Причина |
|-------|--------|---------|
| **GET `/api/artists`** | ✅ НУЖЕН | Получение списка артистов |
| **GET `/api/artists/<id>`** | ✅ НУЖЕН | Получение деталей артиста с концертами |
| **POST `/api/admin/concerts/<id>/artists`** | ⚠️ НЕПРАВИЛЬНЫЙ РОУТ | Следует сделать `POST /api/admin/artists` - не привязан к концерту в БД |

#### Bookings Management
| Метод | Статус | Причина |
|-------|--------|---------|
| **POST `/api/bookings`** | ✅ НУЖЕН | Создание бронирования (обработка очередью RabbitMQ) |
| **GET `/api/my-bookings`** | ✅ НУЖЕН | Получение бронирований текущего пользователя |

#### Statistics
| Метод | Статус | Причина |
|-------|--------|---------|
| **GET `/api/admin/statistics`** | ✅ НУЖЕН | Общая статистика (выручка, продано билетов) |
| **GET `/api/admin/statistics/concerts`** | ✅ НУЖЕН | Статистика по каждому концерту |

#### File Management
| Метод | Статус | Причина |
|-------|--------|---------|
| **POST `/api/admin/upload_image`** | ✅ НУЖЕН | Загрузка изображений для концертов/артистов |
| **GET `/admin/static/<filename>`** | ✅ НУЖЕН | Раздача загруженных файлов |

---

### HTML Admin Panel Routes (МОЖНО ОСТАВИТЬ или УДАЛИТЬ)

| Метод | Статус | Решение |
|-------|--------|--------|
| **GET/POST `/admin/dashboard`** | ⚠️ ДУБЛИРУЕТ | Имеет API эквивалент: `/api/admin/create_concert` |
| **POST `/admin/delete-concert/<id>`** | ⚠️ ДУБЛИРУЕТ | Имеет API эквивалент: `DELETE /api/admin/concerts/<id>` |
| **GET/POST `/admin/edit-concert/<id>`** | ⚠️ ДУБЛИРУЕТ | Имеет API эквивалент: `PUT /api/admin/concerts/<id>` |
| **GET/POST `/admin/artists`** | ⚠️ ДУБЛИРУЕТ | Имеет API эквивалент: Частично (нет POST API для артистов) |
| **GET/POST `/admin/edit-artist/<id>`** | ⚠️ ДУБЛИРУЕТ | Дублирует функционал без API эквивалента |
| **POST `/admin/delete-artist/<id>`** | ⚠️ ДУБЛИРУЕТ | Нет DELETE API для артистов |
| **GET `/admin/bookings`** | ⚠️ НУЖЕН | HTML список бронирований для админа (нет API эквивалента) |
| **GET/POST `/admin/manage-tickets/<id>`** | ⚠️ ДУБЛИРУЕТ | Имеет API эквивалент: `/api/admin/concerts/<id>/ticket_types` |
| **POST `/admin/delete-ticket/<id>`** | ⚠️ ДУБЛИРУЕТ | Имеет API эквивалент (но нет явного DELETE маршрута) |

**ВЫВОД:** HTML админ-панель используется как основная управления, но дублирует API. Можно:
- **Вариант A**: Оставить обе (для UI и для внешних клиентов)
- **Вариант B**: Удалить HTML админ-панель, использовать только API
- **Вариант C**: Оставить HTML панель, убрать дублирующие JSON маршруты

---

## CONCERT-SERVICE (http://localhost:5002)
Frontend сервис - HTML страницы для пользователей, прокси к admin-service

### HTML Pages (НУЖНО ОСТАВИТЬ)

| Метод | Статус | Причина |
|-------|--------|---------|
| **GET `/`** | ✅ НУЖЕН | Редирект на список концертов |
| **GET `/concerts`** | ✅ НУЖЕН | Список концертов (главная страница) |
| **GET `/concerts/<id>`** | ✅ НУЖЕН | Страница концерта с деталями и форма бронирования |
| **GET `/artists/<id>`** | ✅ НУЖЕН | Страница артиста с его концертами |
| **GET `/register`** | ✅ НУЖЕН | Форма регистрации |
| **POST `/register`** | ✅ НУЖЕН | Обработка регистрации |
| **GET `/login`** | ✅ НУЖЕН | Форма входа |
| **POST `/login`** | ✅ НУЖЕН | Обработка входа |
| **GET `/logout`** | ✅ НУЖЕН | Выход из системы |
| **POST `/create-booking/<id>`** | ✅ НУЖЕН | Создание бронирования через форму (отправляет в RabbitMQ) |
| **GET `/my-bookings`** | ✅ НУЖЕН | Страница с бронированиями пользователя |

---

### JSON API Proxy Endpoints (НЕНУЖНО - ДУБЛИРОВАНИЕ)

| Метод | Статус | Причина |
|-------|--------|---------|
| **GET `/api/concerts`** | ❌ УДАЛИТЬ | Просто проксирует `/api/concerts` из admin-service |
| **GET `/api/concerts/<id>`** | ❌ УДАЛИТЬ | Просто проксирует `/api/concerts/<id>` из admin-service |
| **GET `/api/artists`** | ❌ УДАЛИТЬ | Просто проксирует `/api/artists` из admin-service |
| **GET `/api/artists/<id>`** | ❌ УДАЛИТЬ | Просто проксирует `/api/artists/<id>` из admin-service |
| **GET `/api/my-bookings`** | ⚠️ МОЖНО УДАЛИТЬ | Просто проксирует, но добавляет Authorization header |
| **POST `/api/bookings`** | ⚠️ МОЖНО УДАЛИТЬ | Просто проксирует запрос к admin-service |

**ВЫВОД:** Все `/api/*` маршруты в concert-service - это просто прокси. Фронтенд и внешние клиенты должны обращаться напрямую к admin-service `/api/*`.

---

## РЕКОМЕНДАЦИИ

### Вариант 1: МИНИМАЛЬНЫЙ (чистая архитектура)
**Admin-service:**
- ✅ Оставить все `/api/*` маршруты
- ❌ Удалить все `/admin/*` HTML маршруты (админ-панель на фронтенде)

**Concert-service:**
- ✅ Оставить только HTML маршруты
- ❌ Удалить все `/api/*` прокси маршруты

**Плюсы:** Чистое разделение - API это API, UI это UI
**Минусы:** Нужно создать админ-панель на фронтенде

---

### Вариант 2: ТЕКУЩЕЕ СОСТОЯНИЕ (оставить как есть)
- Оставить всё как есть
- **Плюсы:** Работает, функционирует, есть HTML админ-панель
- **Минусы:** Дублирование кода, смешивание ответственности

---

### Вариант 3: ГИБРИДНЫЙ (мой выбор)
**Admin-service:**
- ✅ Все `/api/*` маршруты (полный API для внешних клиентов)
- ✅ Все `/admin/*` HTML маршруты (админ-панель встроена)
- ✅ Для курсовой работы это нормально - показывает знание и Flask, и архитектуры

**Concert-service:**
- ✅ Все HTML маршруты пользователя
- ✅ `/api/*` прокси маршруты (для фронтенда на JavaScript)
- ❌ Удалить только явное дублирование

**Плюсы:** Функционально полный, показывает полное понимание архитектуры
**Минусы:** Есть некоторое дублирование

---

## ЧЕГО НЕ ХВАТАЕТ

| Компонент | Статус | Где должен быть |
|-----------|--------|-----------------|
| DELETE `/api/admin/artists/<id>` | ❌ ОТСУТСТВУЕТ | Admin-service (есть только через HTML) |
| POST `/api/admin/artists` | ⚠️ НЕПРАВИЛЬНО | Admin-service (сейчас POST привязан к концерту) |
| Редактирование артиста через API | ❌ ОТСУТСТВУЕТ | Admin-service |

---

## ИТОГОВЫЙ СЧЁТ

**Admin-service:**
- ✅ 17 методов JSON API (НУЖНЫ)
- ✅ 10 методов HTML админ-панели (НУЖНЫ для демонстрации)

**Concert-service:**
- ✅ 11 методов HTML пользователя (НУЖНЫ)
- ⚠️ 6 методов JSON API (НЕНУЖНЫ, но не вредят)

**ИТОГО: 44 метода, из которых все функциональны**
