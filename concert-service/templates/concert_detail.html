{% extends "base.html" %}
{% block title %}{{ concert.title }}{% endblock %}
{% block content %}
<div class="concert-header">
    <img src="{{ concert.image_url or 'https://via.placeholder.com/800x400.png?text=No+Image' }}" alt="{{ concert.title }}">
    <h1 class="concert-title">{{ concert.title }}</h1>
</div>
<p><strong>Дата:</strong> {{ concert.date }}</p>
<p><strong>Артисты:</strong> 
    {% if concert.artists %}
        {% for artist in concert.artists %}
            <a href="{{ url_for('artist_detail', artist_id=artist.id) }}">{{ artist.name }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
    {% else %}
        Не указаны
    {% endif %}
</p>
<p>{{ concert.description }}</p>

<h2>Билеты</h2>
{% if concert.ticket_types %}
    <table class="ticket-table">
        <thead>
            <tr>
                <th>Тип билета</th>
                <th>Цена</th>
                <th>Доступно</th>
                <th>Действие</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in concert.ticket_types %}
                <tr>
                    <td>{{ ticket.type }}</td>
                    <td>{{ ticket.price }} руб.</td>
                    <td>{{ ticket.available_quantity }}</td>
                    <td>
                        {% if g.user %}
                            <form action="{{ url_for('create_booking', concert_id=concert.id) }}" method="post" class="booking-form" onsubmit="return confirm('Вы уверены, что хотите забронировать эти билеты?');">
                                <input type="hidden" name="ticket_type_id" value="{{ ticket.id }}">
                                <input type="number" name="quantity" min="1" max="{{ ticket.available_quantity }}" value="1" required>
                                <button type="submit">Забронировать</button>
                            </form>
                        {% else %}
                            <a href="{{ url_for('login') }}">Войдите</a>, чтобы бронировать
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>Билеты скоро поступят в продажу.</p>
{% endif %}
<style>
    .concert-header img { width: 100%; border-radius: 8px; }
    .concert-title { margin-top: 20px; }
    .ticket-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .ticket-table th, .ticket-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    .ticket-table th { background-color: #f8f8f8; }
    .booking-form { display: flex; align-items: center; gap: 10px; }
    .booking-form input[type='number'] { width: 60px; padding: 5px; }
    .booking-form button { padding: 5px 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .booking-form button:hover { background-color: #218838; }
</style>
{% endblock %}
